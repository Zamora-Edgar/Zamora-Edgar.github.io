<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Texas Hold'em - Betting Edition</title>
    <style>
        body { background-color: #202020; color: white; font-family: sans-serif; text-align: center; overflow: hidden; }
        
        /* TABLE & LAYOUT */
        .poker-table {
            position: relative; width: 800px; height: 500px;
            background-color: #35654d; border: 15px solid #4a2c20;
            border-radius: 250px; margin: 20px auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .community-area {
            position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; gap: 5px;
        }

        .pot-display {
            position: absolute; top: 55%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.5); padding: 5px 15px;
            border-radius: 20px; font-weight: bold; color: #e3b341;
        }

        /* PLAYERS */
        .player-seat {
            position: absolute; width: 130px; text-align: center;
            background: rgba(0,0,0,0.7); padding: 5px; border-radius: 8px;
            transition: all 0.3s; border: 2px solid transparent;
        }
        .player-seat.active { border-color: #e3b341; box-shadow: 0 0 15px #e3b341; background: #444; }
        .player-seat.folded { opacity: 0.5; }
        .player-seat.winner { background: #238636; transform: scale(1.1); z-index: 10; border-color: white; }

        .chips { color: #85e89d; font-size: 0.9rem; margin-top: 2px; }
        .status-bubble { 
            background: #1f6feb; color: white; font-size: 0.7rem; 
            padding: 2px 6px; border-radius: 10px; display: inline-block; margin-bottom: 2px;
        }

        /* CARDS */
        .card {
            background: white; color: black; width: 35px; height: 50px;
            display: inline-flex; justify-content: center; align-items: center;
            border-radius: 4px; font-weight: bold; margin: 2px; font-size: 0.8rem;
        }
        .card.red { color: #d73a49; }

        /* UI CONTROLS */
        .controls-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #161b22; padding: 15px; border-top: 1px solid #30363d;
            display: flex; justify-content: center; gap: 10px;
        }
        .btn { padding: 10px 20px; font-size: 1.1rem; border: none; border-radius: 5px; color: white; cursor: pointer; }
        .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.5; }
        .btn-fold { background: #d73a49; }
        .btn-check { background: #1f6feb; }
        .btn-raise { background: #e3b341; color: black; }
        
        #game-log { position: absolute; top: 10px; left: 10px; text-align: left; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>

    <div id="game-log">Log: <span id="log-text">Waiting to start...</span></div>

    <div class="poker-table" id="table">
        <div class="community-area" id="community-cards"></div>
        <div class="pot-display">Pot: $<span id="pot-amount">0</span></div>
    </div>

    <div class="controls-bar">
        <button class="btn btn-fold" id="btn-fold" onclick="humanAction('fold')">Fold</button>
        <button class="btn btn-check" id="btn-check" onclick="humanAction('call')">Check/Call</button>
        <button class="btn btn-raise" id="btn-raise" onclick="humanAction('raise')">Raise $50</button>
        <button class="btn" style="background:#238636; display:none;" id="btn-next" onclick="startHand()">Next Hand</button>
    </div>

<script>
    // --- CONFIG & STATE ---
    const TOTAL_PLAYERS = 6;
    const STARTING_STACK = 1000;
    const BLIND = 20;

    const suits = ['♥', '♦', '♣', '♠'];
    const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const values = { '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14 };

    let deck = [], players = [], community = [];
    let pot = 0;
    let currentBet = 0; // The highest bet on the table
    let activePlayerIndex = 0;
    let dealerIndex = 0;
    let stage = 0; // 0:Pre, 1:Flop, 2:Turn, 3:River
    let turnQueue = []; // Who needs to act?

    // --- SETUP ---
    class Card {
        constructor(s, r) { this.suit = s; this.rank = r; this.val = values[r]; }
        getHTML() {
            const color = (this.suit === '♥' || this.suit === '♦') ? 'red' : 'black';
            return `<div class="card ${color}">${this.rank}${this.suit}</div>`;
        }
    }

    function initGame() {
        players = [];
        // Human is Player 0
        players.push({ id: 0, name: "YOU", chips: STARTING_STACK, hand: [], status: 'active', currentBet: 0 });
        for(let i=1; i<TOTAL_PLAYERS; i++) {
            players.push({ id: i, name: `Bot ${i}`, chips: STARTING_STACK, hand: [], status: 'active', currentBet: 0 });
        }
        renderSeats();
        startHand();
    }

    function startHand() {
        // Reset State
        deck = createDeck();
        community = [];
        pot = 0;
        currentBet = BLIND;
        stage = 0;
        
        players.forEach(p => {
            if(p.chips > 0) {
                p.status = 'active';
                p.hand = [deck.pop(), deck.pop()];
                p.currentBet = 0;
            } else {
                p.status = 'bust';
            }
            updateSeatUI(p);
        });

        // Blinds (Simplified: Dealer pays blind)
        dealerIndex = (dealerIndex + 1) % TOTAL_PLAYERS;
        betChips(players[dealerIndex], BLIND);
        
        renderCommunity();
        log(`New Hand. Dealer (Bot ${dealerIndex}) posts $${BLIND}.`);
        
        // Start Betting Round
        document.getElementById('btn-next').style.display = 'none';
        startBettingRound();
    }

    // --- BETTING LOGIC ---
    function startBettingRound() {
        // Queue active players starting after dealer
        turnQueue = [];
        for(let i=1; i<=TOTAL_PLAYERS; i++) {
            let idx = (dealerIndex + i) % TOTAL_PLAYERS;
            if(players[idx].status === 'active') turnQueue.push(idx);
        }
        nextTurn();
    }

    function nextTurn() {
        // If queue empty, go to next stage (Flop/Turn/River)
        if (turnQueue.length === 0) {
            advanceStage();
            return;
        }

        activePlayerIndex = turnQueue.shift();
        const p = players[activePlayerIndex];

        // Highlight Active Seat
        document.querySelectorAll('.player-seat').forEach(el => el.classList.remove('active'));
        document.getElementById(`seat-${p.id}`).classList.add('active');

        // Check if everyone else folded
        const activeCount = players.filter(pl => pl.status !== 'folded' && pl.status !== 'bust').length;
        if (activeCount === 1) {
            endHand([p]); // Winner by default
            return;
        }

        if (p.id === 0) {
            // Human Turn: Enable Buttons
            updateControls(true);
            log("Your turn...");
        } else {
            // Bot Turn: Delay slightly for realism
            updateControls(false); // Disable buttons
            setTimeout(() => botAI(p), 800);
        }
    }

    function botAI(bot) {
        // AI LOGIC:
        // 1. Calculate Hand Strength (High Card + Pairs)
        const score = getHandStrength(bot.hand, community);
        const toCall = currentBet - bot.currentBet;
        
        // Decision Tree
        let action = 'fold';

        if (score > 15 || toCall === 0) action = 'call'; // Always check if free
        if (score > 20 && Math.random() > 0.7) action = 'raise'; // Random aggression
        if (score < 5 && toCall > 50) action = 'fold'; // Fold weak hands to big bets

        // Execute
        if (action === 'raise') {
            const raiseAmt = 50;
            if (bot.chips >= toCall + raiseAmt) {
                betChips(bot, toCall + raiseAmt);
                currentBet += raiseAmt;
                log(`${bot.name} Raises to $${currentBet}`);
                // If raise, everyone else must act again
                addOthersToQueue(bot.id);
            } else {
                action = 'call'; // Not enough chips, just call
            }
        }

        if (action === 'call') {
            if (bot.chips >= toCall) {
                betChips(bot, toCall);
                log(`${bot.name} Calls.`);
            } else {
                // All-in
                betChips(bot, bot.chips);
                log(`${bot.name} goes All-in!`);
            }
        }
        
        if (action === 'fold') {
            bot.status = 'folded';
            document.getElementById(`seat-${bot.id}`).classList.add('folded');
            log(`${bot.name} Folds.`);
        }

        updateSeatUI(bot);
        nextTurn();
    }

    function humanAction(act) {
        const p = players[0];
        const toCall = currentBet - p.currentBet;

        if (act === 'fold') {
            p.status = 'folded';
            document.getElementById(`seat-0`).classList.add('folded');
            log("You folded.");
        } 
        else if (act === 'call') {
            betChips(p, Math.min(p.chips, toCall));
            log("You called.");
        } 
        else if (act === 'raise') {
            const raiseAmt = 50;
            if (p.chips >= toCall + raiseAmt) {
                betChips(p, toCall + raiseAmt);
                currentBet += raiseAmt;
                log(`You raised to $${currentBet}`);
                addOthersToQueue(0);
            }
        }
        
        updateSeatUI(p);
        updateControls(false);
        nextTurn();
    }

    // --- GAME STAGES ---
    function advanceStage() {
        if (stage === 3) {
            showdown();
            return;
        }

        // Deal Cards
        if (stage === 0) { // Flop
            community.push(deck.pop(), deck.pop(), deck.pop());
            log("Flop dealt.");
        } else { // Turn & River
            community.push(deck.pop());
            log(stage === 1 ? "Turn dealt." : "River dealt.");
        }
        
        renderCommunity();
        stage++;
        
        // Reset betting for new round? 
        // (Simplified: keeping bet cumulative for this demo, usually resets to 0)
        startBettingRound();
    }

    function showdown() {
        log("Showdown!");
        let bestScore = -1;
        let winners = [];

        // Reveal Cards & Calc Scores
        players.forEach(p => {
            if (p.status !== 'folded' && p.status !== 'bust') {
                // Reveal Hand
                const handDiv = document.getElementById(`hand-${p.id}`);
                handDiv.innerHTML = p.hand.map(c => c.getHTML()).join('');
                
                // Score
                const score = getHandStrength(p.hand, community);
                if (score > bestScore) {
                    bestScore = score;
                    winners = [p];
                } else if (score === bestScore) {
                    winners.push(p);
                }
            }
        });

        endHand(winners);
    }

    function endHand(winners) {
        const share = Math.floor(pot / winners.length);
        let text = "";
        winners.forEach(w => {
            w.chips += share;
            document.getElementById(`seat-${w.id}`).classList.add('winner');
            text += w.name + " ";
            updateSeatUI(w);
        });
        
        log(`Winner: ${text} wins $${share}!`);
        pot = 0;
        updatePot();
        document.getElementById('btn-next').style.display = 'inline-block';
        updateControls(false);
    }

    // --- HELPERS ---
    function betChips(p, amount) {
        p.chips -= amount;
        p.currentBet += amount;
        pot += amount;
        if(p.currentBet > currentBet) currentBet = p.currentBet;
        updatePot();
    }

    function addOthersToQueue(raiserId) {
        // If someone raises, everyone active (except raiser) must decide again
        turnQueue = [];
        for(let i=1; i<TOTAL_PLAYERS; i++) {
            let idx = (raiserId + i) % TOTAL_PLAYERS;
            if(players[idx].status !== 'folded' && players[idx].status !== 'bust') {
                turnQueue.push(idx);
            }
        }
    }

    function getHandStrength(hand, comm) {
        // Simplified Logic for Demo:
        // Returns number: High Card (2-14), Pair (20+), 2Pair (40+), Trips (60+)
        const all = [...hand, ...comm];
        const counts = {};
        all.forEach(c => counts[c.val] = (counts[c.val] || 0) + 1);
        
        let score = 0;
        // High card
        hand.forEach(c => { if(c.val > score) score = c.val; });

        // Pairs/Trips
        Object.values(counts).forEach(count => {
            if(count === 2) score += 20;
            if(count === 3) score += 60;
            if(count === 4) score += 100;
        });
        return score;
    }

    function updateSeatUI(p) {
        const el = document.getElementById(`seat-${p.id}`);
        el.querySelector('.chips').innerText = `$${p.chips}`;
        
        if(p.status === 'folded') {
            el.querySelector('.status').innerText = 'Folded';
            el.classList.add('folded');
        } else {
            el.querySelector('.status').innerText = p.currentBet > 0 ? `$${p.currentBet}` : '';
        }

        // Keep cards hidden for bots unless showdown
        const handDiv = document.getElementById(`hand-${p.id}`);
        if(p.id === 0 || stage > 3) { 
            handDiv.innerHTML = p.hand.map(c => c.getHTML()).join('');
        } else {
            handDiv.innerHTML = `<div class="card" style="background:#555">?</div><div class="card" style="background:#555">?</div>`;
        }
    }

    function updateControls(enabled) {
        const p0 = players[0];
        const callAmt = currentBet - p0.currentBet;
        document.getElementById('btn-fold').disabled = !enabled;
        document.getElementById('btn-check').disabled = !enabled;
        document.getElementById('btn-raise').disabled = !enabled;
        
        document.getElementById('btn-check').innerText = callAmt === 0 ? "Check" : `Call $${callAmt}`;
    }

    function renderSeats() {
        const table = document.getElementById('table');
        // Clear old seats (keep community/pot)
        document.querySelectorAll('.player-seat').forEach(e => e.remove());

        const radiusX = 350; const radiusY = 210;
        players.forEach((p, index) => {
            const angle = (index / TOTAL_PLAYERS) * (2 * Math.PI) + (Math.PI / 2);
            const x = 400 + radiusX * Math.cos(angle) - 65;
            const y = 250 + radiusY * Math.sin(angle) - 40;

            const div = document.createElement('div');
            div.className = 'player-seat';
            div.id = `seat-${p.id}`;
            div.style.left = `${x}px`; div.style.top = `${y}px`;
            div.innerHTML = `
                <div style="font-size:0.8rem; color:#aaa;">${p.name}</div>
                <div class="status-bubble status"></div>
                <div id="hand-${p.id}" style="display:flex; justify-content:center;"></div>
                <div class="chips">$${p.chips}</div>
            `;
            table.appendChild(div);
        });
    }

    function createDeck() {
        let d = [];
        for(let s of suits) for(let r of ranks) d.push(new Card(s,r));
        return d.sort(()=>Math.random()-0.5);
    }
    
    function renderCommunity() {
        const d = document.getElementById('community-cards');
        d.innerHTML = community.map(c => c.getHTML()).join('');
    }

    function updatePot() { document.getElementById('pot-amount').innerText = pot; }
    function log(msg) { document.getElementById('log-text').innerText = msg; }

    initGame();
</script>
</body>
</html>
