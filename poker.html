<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Texas Hold'em Simulator</title>
    <style>
        body { background-color: #202020; color: white; font-family: sans-serif; text-align: center; overflow: hidden; }
        
        /* SETUP SCREEN */
        #setup-screen { margin-top: 100px; }
        input[type=number] { padding: 10px; font-size: 1.2rem; width: 60px; text-align: center; }
        
        /* POKER TABLE */
        .poker-table {
            position: relative;
            width: 800px;
            height: 500px;
            background-color: #35654d;
            border: 15px solid #4a2c20;
            border-radius: 250px;
            margin: 50px auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* CARDS */
        .card {
            background: white; color: black; width: 40px; height: 60px;
            display: inline-flex; justify-content: center; align-items: center;
            border-radius: 4px; font-weight: bold; margin: 2px; font-size: 0.9rem;
            border: 1px solid #999;
        }
        .card.red { color: #d73a49; }
        .card.black { color: #24292e; }

        /* COMMUNITY CARDS */
        .community-area {
            position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; gap: 5px;
        }

        /* PLAYERS */
        .player-seat {
            position: absolute;
            width: 120px;
            text-align: center;
            background: rgba(0,0,0,0.6);
            padding: 5px;
            border-radius: 8px;
            transition: all 0.5s;
        }
        .player-seat.active { border: 2px solid #e3b341; box-shadow: 0 0 10px #e3b341; }
        .player-seat.winner { background: #238636; transform: scale(1.1); z-index: 10; }
        
        .bot-name { font-size: 0.8rem; color: #aaa; margin-bottom: 2px; }
        .hand-desc { font-size: 0.7rem; color: #e3b341; display: none; }

        /* CONTROLS */
        .controls { margin-top: 20px; }
        .btn { padding: 12px 24px; font-size: 1.1rem; cursor: pointer; border: none; border-radius: 5px; color: white; margin: 5px; }
        .btn-green { background: #238636; }
        .btn-blue { background: #1f6feb; }
        .btn-red { background: #d73a49; }

        .log-area { margin-top: 20px; color: #888; font-size: 0.9rem; }
        .back-link { display: block; margin-top: 20px; color: #58a6ff; text-decoration: none; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1>Texas Hold'em Setup</h1>
        <p>How many players? (2 - 8)</p>
        <input type="number" id="player-count" value="4" min="2" max="8">
        <br><br>
        <button class="btn btn-green" onclick="startGame()">Sit Down</button>
        <br>
        <a href="index.html" class="back-link">← Back to Portfolio</a>
    </div>

    <div id="game-screen" style="display:none;">
        <div class="poker-table" id="table">
            <div class="community-area" id="community-cards"></div>
            </div>

        <div class="controls">
            <button class="btn btn-blue" onclick="nextStage()" id="action-btn">Deal Flop</button>
            <button class="btn btn-red" onclick="resetGame()" style="display:none;" id="reset-btn">Next Hand</button>
        </div>
        <div class="log-area" id="game-log">Game Started. Good Luck.</div>
    </div>

<script>
    const suits = ['♥', '♦', '♣', '♠'];
    const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const values = { '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14 };

    let deck = [], players = [], community = [];
    let stage = 0; // 0:Pre, 1:Flop, 2:Turn, 3:River, 4:Showdown

    class Card {
        constructor(suit, rank) { this.suit = suit; this.rank = rank; this.val = values[rank]; }
        getHTML() {
            const color = (this.suit === '♥' || this.suit === '♦') ? 'red' : 'black';
            return `<div class="card ${color}">${this.rank}${this.suit}</div>`;
        }
    }

    function createDeck() {
        deck = [];
        for (let s of suits) for (let r of ranks) deck.push(new Card(s, r));
        deck.sort(() => Math.random() - 0.5);
    }

    function startGame() {
        const count = document.getElementById('player-count').value;
        if (count < 2 || count > 8) return alert("Please choose 2-8 players");

        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        
        // Create Players
        players = [];
        // Human is Player 0
        players.push({ name: "YOU", hand: [], id: 0, chips: 1000 });
        for (let i = 1; i < count; i++) {
            players.push({ name: `Bot ${i}`, hand: [], id: i, chips: 1000 });
        }

        renderTableLayout(count);
        startHand();
    }

    function renderTableLayout(count) {
        const table = document.getElementById('table');
        // Keep community area, remove old seats
        const comm = document.getElementById('community-cards');
        table.innerHTML = ''; 
        table.appendChild(comm);

        // Positioning logic (Circle)
        const radiusX = 350; // Width radius
        const radiusY = 210; // Height radius
        const centerX = 400;
        const centerY = 250;

        players.forEach((p, index) => {
            const angle = (index / count) * (2 * Math.PI) + (Math.PI / 2); // Start bottom
            const x = centerX + radiusX * Math.cos(angle) - 60; // -60 center div
            const y = centerY + radiusY * Math.sin(angle) - 40;

            const div = document.createElement('div');
            div.className = 'player-seat';
            div.id = `seat-${index}`;
            div.style.left = `${x}px`;
            div.style.top = `${y}px`;
            div.innerHTML = `
                <div class="bot-name">${p.name}</div>
                <div id="hand-${index}"></div>
                <div id="desc-${index}" class="hand-desc"></div>
            `;
            table.appendChild(div);
        });
    }

    function startHand() {
        createDeck();
        community = [];
        stage = 0;
        document.getElementById('community-cards').innerHTML = '';
        document.getElementById('action-btn').style.display = 'inline-block';
        document.getElementById('action-btn').innerText = "Deal Flop";
        document.getElementById('reset-btn').style.display = 'none';
        document.getElementById('game-log').innerText = "Pre-Flop: Everyone has 2 cards.";

        players.forEach(p => {
            p.hand = [deck.pop(), deck.pop()];
            const handDiv = document.getElementById(`hand-${p.id}`);
            const seat = document.getElementById(`seat-${p.id}`);
            seat.classList.remove('winner');
            document.getElementById(`desc-${p.id}`).style.display = 'none';

            if (p.id === 0) {
                // Show Human Cards
                handDiv.innerHTML = p.hand[0].getHTML() + p.hand[1].getHTML();
            } else {
                // Hide Bot Cards
                handDiv.innerHTML = `<div class="card" style="background:#444; border:1px solid white;">?</div><div class="card" style="background:#444; border:1px solid white;">?</div>`;
            }
        });
    }

    function nextStage() {
        const commDiv = document.getElementById('community-cards');
        const btn = document.getElementById('action-btn');

        if (stage === 0) { // Deal Flop (3 cards)
            for(let i=0; i<3; i++) community.push(deck.pop());
            btn.innerText = "Deal Turn";
            stage++;
        } else if (stage === 1) { // Deal Turn (1 card)
            community.push(deck.pop());
            btn.innerText = "Deal River";
            stage++;
        } else if (stage === 2) { // Deal River (1 card)
            community.push(deck.pop());
            btn.innerText = "Showdown!";
            stage++;
        } else if (stage === 3) { // Showdown
            determineWinner();
            btn.style.display = 'none';
            document.getElementById('reset-btn').style.display = 'inline-block';
            stage++;
            return;
        }

        // Render Community
        commDiv.innerHTML = '';
        community.forEach(c => commDiv.innerHTML += c.getHTML());
    }

    function determineWinner() {
        let bestScore = -1;
        let winners = [];

        players.forEach(p => {
            // Reveal Bot Cards
            const handDiv = document.getElementById(`hand-${p.id}`);
            handDiv.innerHTML = p.hand[0].getHTML() + p.hand[1].getHTML();

            // Evaluate 7 Cards (2 hand + 5 community)
            const allCards = [...p.hand, ...community];
            const score = evaluate7Cards(allCards);
            
            // UI Update
            const descDiv = document.getElementById(`desc-${p.id}`);
            descDiv.innerText = score.name;
            descDiv.style.display = 'block';

            if (score.val > bestScore) {
                bestScore = score.val;
                winners = [p];
            } else if (score.val === bestScore) {
                winners.push(p);
            }
        });

        // Highlight Winners
        let winText = "";
        winners.forEach(w => {
            document.getElementById(`seat-${w.id}`).classList.add('winner');
            winText += w.name + " ";
        });
        document.getElementById('game-log').innerText = `Winner: ${winText} with ${winners[0].handScoreName}`;
    }

    function resetGame() { startHand(); }

    // --- EVALUATION LOGIC (Simplified for 7 cards) ---
    function evaluate7Cards(cards) {
        // Sort by value descending
        cards.sort((a,b) => b.val - a.val);
        
        const counts = {};
        const suits = {};
        cards.forEach(c => {
            counts[c.val] = (counts[c.val] || 0) + 1;
            suits[c.suit] = (suits[c.suit] || 0) + 1;
        });

        const flushSuit = Object.keys(suits).find(s => suits[s] >= 5);
        const isStraight = checkStraight(cards); // Returns highest card of straight or 0

        // 1. Straight Flush (Simplified: just checks if flush & straight exist, not necessarily same cards. Strict check is complex for this snippet)
        if (flushSuit && isStraight > 0) return { val: 800 + isStraight, name: "Straight Flush" };

        // 2. Four of a Kind
        const fourVal = Object.keys(counts).find(k => counts[k] === 4);
        if (fourVal) return { val: 700 + parseInt(fourVal), name: "Four of a Kind" };

        // 3. Full House
        const threeVal = Object.keys(counts).find(k => counts[k] === 3);
        const pairVal = Object.keys(counts).find(k => counts[k] === 2);
        if (threeVal && pairVal) return { val: 600 + parseInt(threeVal), name: "Full House" };
        
        // 4. Flush
        if (flushSuit) return { val: 500, name: "Flush" };

        // 5. Straight
        if (isStraight > 0) return { val: 400 + isStraight, name: "Straight" };

        // 6. Three of a Kind
        if (threeVal) return { val: 300 + parseInt(threeVal), name: "Three of a Kind" };

        // 7. Two Pair
        const pairs = Object.keys(counts).filter(k => counts[k] === 2);
        if (pairs.length >= 2) return { val: 200 + parseInt(pairs[pairs.length-1]), name: "Two Pair" };

        // 8. One Pair
        if (pairs.length === 1) return { val: 100 + parseInt(pairs[0]), name: "Pair" };

        // 9. High Card
        return { val: cards[0].val, name: "High Card" };
    }

    function checkStraight(cards) {
        const uniqueVals = [...new Set(cards.map(c => c.val))]; // Remove duplicates
        let streak = 0;
        for (let i = 0; i < uniqueVals.length - 1; i++) {
            if (uniqueVals[i] - uniqueVals[i+1] === 1) streak++;
            else streak = 0;
            if (streak === 4) return uniqueVals[i - 3]; // Return highest card
        }
        return 0;
    }

</script>
</body>
</html>
